<html>
  <head>
    <title>Books API Example</title>
  </head>
  <body>
    <div id="content">
    </div>
    <form class="" action="index.html" onsubmit="loadBooks()">

    </form>
    <input type="text" id="query" placeholder="Search books">
    <button id="searchButton" type="submit" name="button">Search</button>

    </form>
    <script>
    //   function searchBooks(response){
    //   for (let i = 0; i < 5; i++) {
    //     let item = response.items[i];
    //     // in production code, item.text should have the HTML entities escaped.
    //     document.getElementById("content").innerHTML += "<br>"
    //     document.getElementById("content").innerHTML += "<br>" + item.volumeInfo.title;
    //     console.log(response);
    //   }
    // }

    document.getElementById("searchButton").addEventListener("click", function(){
      loadBooks();
    });

    function loadBooks() {
      //Loading the books using an async call
      let query = document.getElementById("query").value;
      // Because we are not submitting a form through the browser, I am formating the query
      // and appending it to the url of the api to mimic a GET function
      query = query.replace(" ", "+");
      let baseURL = "https://www.googleapis.com/books/v1/volumes?q=" + query;

      let xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {

         let info =(JSON.parse(this.responseText));
         getFiveItems(info)
      // } else if(this.readyState == 4 && this.status != 200){
      //      console.log("There has been an error with the http request, try checking the values you submitted on the form");
      //      console.log(JSON.parse(this.responseText));
          }
        };
      xhr.open("GET", baseURL, true);
      xhr.send();
    }

    function getFiveItems(jsonBooks){
      //This reads a JSON string from the google books API and formats it in a way which is according to the assignment
      //that is gives the following info: Author(s), title of the book, publishing house on the console
      let listLength = jsonBooks.items.length;
      if (listLength != 0){
          for (let i = 0; i < listLength; i++) {
            if(i == 5){break};
            printBookInfo(jsonBooks.items[i], i);

          }
      } else{
        console.log("The query matched no books");
        };
      }

      function printBookInfo(book, i){
        console.log("Entry " + (i+1));
        console.log(book.volumeInfo.authors[0]);
        console.log(book.volumeInfo.title);
        console.log(book.volumeInfo.publisher);
        console.log(" ");
      }


    </script>
  </body>
</html>
