<html>
  <head>
    <title>8th Light - Code Challenge</title>
  </head>
  <body>
    <div id="content">
    </div>
    <form id="searchBooksForm">
      <input type="text" id="query" placeholder="Search Books">
      <button id="searchButton" type="submit" name="button">Search</button>
    </form>

    <script>
    document.getElementById("searchBooksForm").addEventListener('submit', e => {
        loadBooks();
        setTimeout(function(){
          console.log("Select entry number to add book to your reading list:");
        }, 1000);
        // Prevent the default form submit
        e.preventDefault();
    });

    function loadBooks() {
      //Loading the books using an async call

      let query = document.getElementById("query").value;
      document.getElementById("query").value = "";
      // Appending query to the url of the api to mimic a GET function

      //A bit of string sanitization and formatting for the request
      //The only special character not allowed is the plus (+) sign which would confuse the query
      query = query.trim();
      query = query.replace("+", "")
      query = query.replace(" ", "+");

      const baseURL = "https://www.googleapis.com/books/v1/volumes?q=" + query;

      const xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {

         let info =(JSON.parse(this.responseText));
         getFiveItems(info)
       } else if(this.readyState == 4 && this.status != 200){
           console.log("There has been an error with the http request, try checking the values you submitted on the form");
           console.log(JSON.parse(this.responseText));
          }
        };
      xhr.open("GET", baseURL, true);
      xhr.send();
    }

    function getFiveItems(jsonBooks){
      //Print the first 5 query items
      const listLength = jsonBooks.items.length;
      if (listLength != 0){
          for (let i = 0; i < listLength; i++) {
            if(i == 5){break};
            printBookInfo(jsonBooks.items[i], i);
            };
      } else{
        console.log("The query matched no books");
        };
      }

      function printBookInfo(book, i){
        //Format how book items are printed for user
        if(book){
        const authors = book.volumeInfo.authors;
        const title = book.volumeInfo.title;
        const publisher = book.volumeInfo.publisher;

        console.log("Entry " + (i+1));
        if (authors != undefined){
          for(let j=0; j < authors.length; j++){
            console.log("Author: "+ authors[j] );
          }
        }else{
            console.log("Author: None");
          }

        console.log("Title: " +title);
        console.log("Publisher: "+publisher);
        console.log(" ");
          }
        }






    </script>
  </body>
</html>
